generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
  // URL configured in prisma.config.ts (Prisma v7+)
}

model User {
  id            String   @id
  email         String   @unique
  emailVerified Boolean  @default(false)
  name          String?
  image         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Custom fields
  username  String  @unique
  firstName String?
  lastName  String?

  // Admin plugin fields
  role       String    @default("user")
  banned     Boolean   @default(false)
  banReason  String?
  banExpires DateTime?

  accounts Account[]
  sessions Session[]
}

model Account {
  id                    String    @id
  userId                String
  accountId             String
  providerId            String
  accessToken           String?
  refreshToken          String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  idToken               String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Session {
  id             String   @id
  userId         String
  token          String   @unique
  expiresAt      DateTime
  ipAddress      String?
  userAgent      String?
  impersonatedBy String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
}

model Cell {
  id                Int @id @default(autoincrement())
  number            Int @unique
  aislesCount       Int
  locationsPerAisle Int
  levelsPerLocation Int

  aisles Aisle[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Aisle {
  id     Int     @id @default(autoincrement())
  number Int
  isOdd  Boolean @default(true)

  cell      Cell       @relation(fields: [cellId], references: [id], onDelete: Cascade)
  cellId    Int
  bays      Bay[]
  locations Location[]
  obstacles Obstacle[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([cellId, number, isOdd])
}

model Bay {
  id     Int @id @default(autoincrement())
  number Int
  width  Int

  aisle     Aisle      @relation(fields: [aisleId], references: [id], onDelete: Cascade)
  aisleId   Int
  locations Location[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([aisleId, number])
}

model Location {
  id        Int     @id @default(autoincrement())
  position  Int
  level     Int
  isPicking Boolean @default(false)
  status    String  @default("AVAILABLE")

  aisle         Aisle        @relation(fields: [aisleId], references: [id], onDelete: Cascade)
  aisleId       Int
  bay           Bay          @relation(fields: [bayId], references: [id], onDelete: Cascade)
  bayId         Int
  blockReason   BlockReason? @relation(fields: [blockReasonId], references: [id], onDelete: SetNull)
  blockReasonId Int?
  obstacles     Obstacle[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([bayId, position, level])
}

model BlockReason {
  id          Int     @id @default(autoincrement())
  code        String  @unique
  name        String
  description String?
  permanent   Boolean @default(false)

  locations Location[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Obstacle {
  id          Int     @id @default(autoincrement())
  type        String
  name        String
  description String?

  aisle     Aisle      @relation(fields: [aisleId], references: [id], onDelete: Cascade)
  aisleId   Int
  locations Location[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
